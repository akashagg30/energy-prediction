{% block content %}
{% csrf_token %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
<h1>System Resource Monitor</h1>
<div id="charts" style="width: 75%;">
    <canvas id="chart1"></canvas>
    <br>
    <br>
    <br>
    <br>
    <canvas id="chart2"></canvas>
</div>


<script>

    var cpu_value=[0,0,0,0,0,0,0,0,0,0]
    var ram_value=[0,0,0,0,0,0,0,0,0,0]

    function utill(value) {
        console.log(value)
        var a = parseFloat(value.split(' ')[0])
        var b = parseFloat(value.split(' ')[1])
        for(var i=0;i<9;++i){
            cpu_value[i]=cpu_value[i+1];
        }
        for(var i=0;i<9;++i){
            ram_value[i]=ram_value[i+1];
        }
        cpu_value[9]=a;
        ram_value[9]=b;
        cpu();
        memory();
    }

    function update(){
        fetch("resources/get").then(function(data) {
            data.text().then( text => utill(text) );
        });
    }

    function cpu(){
        var ctx= document.getElementById('chart1').getContext('2d');
        var chart = new Chart(ctx,{
            type : 'line',
            data : {
                // X axis
                labels: ["","","","","","","","","",""],
                datasets: [
                    // dummy data to plot graph 
                    {
                        // Y label
                        label: '',
                        // Y axis
                        data : [0,0,0,0,0,0,0,0,0,0,100],
                    },
                    {
                        // Y label
                        label: "My dataset",
                        // Y axis
                        data: cpu_value,
                    }
                ]
            },
            options : {
                animation : false,
            },
        });
    }

    function memory(){
        var ctx= document.getElementById('chart2').getContext('2d');
        var chart = new Chart(ctx,{
            type : 'line',
            data : {
                // X axis
                labels: ["","","","","","","","","",""],
                datasets: [
                    // dummy data to plot graph 
                    {
                        // Y label
                        label: '',
                        // Y axis
                        data : [0,0,0,0,0,0,0,0,0,0,100],
                    },
                    {
                        // Y label
                        label: "My dataset",
                        // Y axis
                        data: ram_value,
                    }
                ]
            },
            options : {
                animation : false,
            },
        });
    }

    
    update();
    window.setInterval(function(){update();},3000)
</script>

{% endblock content %}